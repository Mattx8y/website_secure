<title>Redirecting...</title>
<script>
  var code = window.location.search.substring(6);
  var params = {
    "client_id": "448922181062098944",
    "client_secret": "wQwn7MiaMWtgVWmHeqBarkXaDONWBajE",
    "grant_type": "authorization_code",
    "code": code,
    "redirect_uri": "https://secure.mattx8y.gq/api/discord/playevolution/return",
    "scope": "identify"
  };
  var formBody = [];
  for (var property in params) {
    var encodedKey = encodeURIComponent(property);
    var encodedValue = encodeURIComponent(params[property]);
    formBody.push(encodedKey + "=" + encodedValue);
  };
  formBody = formBody.join("&");
  alert(code);
  var xhr = new XMLHttpRequest();
  xhr.onreadystatechange = function() {
    if (xhr.readyState === 4) {
      var response = JSON.parse(xhr.response);
      if (response.error) throw response.error;
      document.cookie = "access_token=" + response.access_token + ";path=/;max-age=" + response.expires_in;
      window.location = "https://www.mattx8y.gq/projects/playevolution";
    };
  };
  xhr.open("POST", "https://discordapp.com/api/oauth2/token", true);
  xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
  xhr.send(formBody);
</script>
